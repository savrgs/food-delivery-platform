<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <h1>FreshEats</h1>
      <h2>Set New Password</h2>
    </div>

    @if (!resetComplete) {
      @if (tokenValid) {
        <form (ngSubmit)="onSubmit()" class="auth-form">
          <p class="auth-description">Enter your new password below.</p>

          @if (error) {
            <div class="error-alert">
              {{ error }}
              <button type="button" class="btn-close-error" (click)="error = ''" title="Close">Ã—</button>
            </div>
          }

          <div class="form-group">
            <label for="password">New Password</label>
            <input
              type="password"
              id="password"
              [(ngModel)]="password"
              name="password"
              placeholder="Enter new password"
              required
              minlength="6"
              [disabled]="loading"
            />
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              [(ngModel)]="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm new password"
              required
              [disabled]="loading"
            />
          </div>

          <button type="submit" class="btn-primary" [disabled]="loading">
            @if (loading) {
              <span>Resetting...</span>
            } @else {
              <span>Reset Password</span>
            }
          </button>

          <div class="form-footer">
            <p>Remember your password? <a routerLink="/login">Sign In</a></p>
          </div>
        </form>
      } @else if (validating) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Validating reset link...</p>
        </div>
      } @else {
        <div class="error-state">
          <div class="error-icon-circle">
            <span class="xmark"></span>
          </div>
          <h3>Invalid or Expired Link</h3>
          <p>This password reset link is invalid or has expired.</p>
          <a routerLink="/forgot-password" class="btn-secondary">Request New Link</a>
          <div class="form-footer">
            <p><a routerLink="/login">Back to Sign In</a></p>
          </div>
        </div>
      }
    } @else {
      <div class="success-state">
        <div class="success-icon-circle">
          <span class="checkmark"></span>
        </div>
        <h3>Password Reset Successful</h3>
        <p>Your password has been changed successfully.</p>
        <a routerLink="/login" class="btn-primary">Sign In</a>
      </div>
    }
  </div>
</div>
